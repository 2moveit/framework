<UserControl
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:m="clr-namespace:Signum.Windows"
	x:Class="Signum.Windows.SearchControl"
	x:Name="me"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="d" xmlns:Microsoft_Windows_Themes="clr-namespace:Microsoft.Windows.Themes;assembly=PresentationFramework.Aero">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="..\Resources.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"  />
        </Grid.RowDefinitions>
        <Expander Visibility="{Binding ElementName=me,Path=FilterVisible, Converter = {x:Static m:Converters.BoolToVisibility}}" VerticalAlignment="Top" ExpandDirection="Up" x:Name="expander" Expanded="expander_Expanded" Collapsed="expander_Expanded">
            <Expander.Header>
                <Label Content="{m:Loc Filters}" VerticalAlignment="Center" Height="28"/>
            </Expander.Header>
            <Grid>
                <m:FilterBuilder  x:Name="filterBuilder"  />
            </Grid>
        </Expander>
        <StackPanel Visibility="{Binding ElementName=me,Path=FilterVisible, Converter = {x:Static m:Converters.BoolToVisibility}}" Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="80,0,0,2" Height="30" Background="Transparent">
            <StackPanel.Resources>
                <Style TargetType="{x:Type Button}" BasedOn="{StaticResource RoundButton}" x:Key="big">
                    <Setter Property="Width" Value="24"/>
                    <Setter Property="Height" Value="24"/>
                    <Setter Property="Margin" Value="3"/>
                    <Setter Property="VerticalAlignment" Value="Center"/>
                </Style>
            </StackPanel.Resources>

            <Button x:Name="btFind" Click="FilterBuilder_SearchClicked"  ToolTip="{m:Loc Find}" Style="{DynamicResource RoundBigButton}" Height="24">
                <StackPanel Orientation="Horizontal">
                    <Border Child="{StaticResource Find}" Width="20" Height="20"/>
                    <TextBlock Text="{m:Loc Find}" TextWrapping="Wrap" Margin="3,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
            <Button x:Name="btCreate" Content="{DynamicResource Create}" Click="btCreate_Click" ToolTip="{m:Loc CreateNew}" Style="{StaticResource big}"/>
            <Button x:Name="btView" Content="{DynamicResource View}" Click="btView_Click" ToolTip="{m:Loc ViewSelected}" Style="{StaticResource big}"/>
            <Menu IsMainMenu="False" HorizontalAlignment="Center" VerticalAlignment="Center" x:Name="menu">
                <!--<MenuItem x:Name="btExcel"  Click="btExcel_Click" ToolTip="{m:Loc ExcelReport}">
                    <Image Source="../Images/excel.png" />
                </MenuItem>
                <MenuItem Header="{m:Loc ExcelReport}" ToolTip="{m:Loc ExportExcelReportPivotTable}">
                    <MenuItem.Icon>
                        <Image Source="../Images/excelDoc.png" Stretch="None"/>
                    </MenuItem.Icon>
                </MenuItem>-->
            </Menu>
        </StackPanel>
        <ListView x:Name="lvResult" 
                  Grid.Row="1" 
                  MinHeight="100"
                  IsSynchronizedWithCurrentItem="True" 
                  Background="WhiteSmoke"
                  SelectionChanged="lvResult_SelectionChanged" 
			      SelectionMode="{Binding Path=MultiSelection, Converter={x:Static m:Converters.BoolToSelectionMode}, ElementName=me}"
			      VirtualizingStackPanel.IsVirtualizing="True"
                  ButtonBase.Click="GridViewColumnHeaderClickedHandler">
            <ListView.View>
                <GridView x:Name="gvResults"/>
            </ListView.View>
            <ListView.ItemContainerStyle>
                <Style TargetType="{x:Type ListViewItem}">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <EventSetter Event="Control.MouseDoubleClick" Handler="lvResult_MouseDoubleClick"/>
                </Style>
            </ListView.ItemContainerStyle>
        </ListView>
        <StackPanel Height="24" Visibility="{Binding ElementName=me,Path=FooterVisible, Converter = {x:Static m:Converters.BoolToVisibility}}" Orientation="Horizontal" Grid.Row="2" Margin="6,4,6,4" HorizontalAlignment="Left"  >
            <TextBlock TextWrapping="Wrap" x:Name="tbResultados" Visibility="Hidden" VerticalAlignment="Center">
                <InlineUIContainer>
        		    <TextBlock Text="{Binding Path=Items.Count, ElementName=lvResult, Mode=Default}" TextWrapping="Wrap" FontWeight="Bold"/>
        	    </InlineUIContainer>
                <Run Text="{m:Loc Results}"/>         
            </TextBlock>
            <TextBlock HorizontalAlignment="Right" VerticalAlignment="Center">    
                <Run Text="{m:Loc Limitation}"/>
            </TextBlock>
            <TextBox x:Name="tbLimite" Text="200" VerticalAlignment="Center"/>
        </StackPanel>
    </Grid>
</UserControl>
