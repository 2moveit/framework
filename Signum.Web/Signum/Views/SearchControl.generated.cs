#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.18010
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace Signum.Web.Views
{
    using System;
    using System.Collections.Generic;
    
    #line 4 "..\..\Signum\Views\SearchControl.cshtml"
    using System.Configuration;
    
    #line default
    #line hidden
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Text;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Routing;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    
    #line 3 "..\..\Signum\Views\SearchControl.cshtml"
    using Signum.Engine.DynamicQuery;
    
    #line default
    #line hidden
    using Signum.Entities;
    
    #line 2 "..\..\Signum\Views\SearchControl.cshtml"
    using Signum.Entities.DynamicQuery;
    
    #line default
    #line hidden
    
    #line 5 "..\..\Signum\Views\SearchControl.cshtml"
    using Signum.Entities.Reflection;
    
    #line default
    #line hidden
    using Signum.Utilities;
    using Signum.Web;
    
    #line 1 "..\..\Signum\Views\SearchControl.cshtml"
    using Signum.Web.Properties;
    
    #line default
    #line hidden
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "1.5.0.0")]
    [System.Web.WebPages.PageVirtualPathAttribute("~/Signum/Views/SearchControl.cshtml")]
    public class SearchControl : System.Web.Mvc.WebViewPage<Context>
    {
        public SearchControl()
        {
        }
        public override void Execute()
        {








            
            #line 8 "..\..\Signum\Views\SearchControl.cshtml"
   
    Model.ReadOnly = false; /*SearchControls Context should never inherit Readonly property of parent context */
    FindOptions findOptions = (FindOptions)ViewData[ViewDataKeys.FindOptions];
    QueryDescription queryDescription = (QueryDescription)ViewData[ViewDataKeys.QueryDescription];
    var entityColumn = queryDescription.Columns.SingleEx(a => a.IsEntity);
    Type entitiesType = Lite.Extract(entityColumn.Type);
    Implementations implementations = entityColumn.Implementations.Value;
    if (findOptions.AllowMultiple == null && findOptions.FilterMode != FilterMode.OnlyResults)
    {
        findOptions.AllowMultiple = Navigator.QuerySettings(findOptions.QueryName).AllowMultiple;
    }
    findOptions.ElementsPerPage = findOptions.ElementsPerPage ?? (Navigator.Manager.QuerySettings.GetOrThrow(findOptions.QueryName, "Missing QuerySettings for QueryName {0}").ElementsPerPage) ?? FindOptions.DefaultElementsPerPage;
    
    ViewData[ViewDataKeys.FindOptions] = findOptions;
    
    JsFindNavigator jsFindNavigator = JsFindNavigator.GetFor(Model.ControlID);


            
            #line default
            #line hidden
WriteLiteral("<div id=\"");


            
            #line 25 "..\..\Signum\Views\SearchControl.cshtml"
    Write(Model.Compose("sfSearchControl"));

            
            #line default
            #line hidden
WriteLiteral("\" \r\n     class=\"sf-search-control\" \r\n     data-prefix=\"");


            
            #line 27 "..\..\Signum\Views\SearchControl.cshtml"
             Write(Model.ControlID);

            
            #line default
            #line hidden
WriteLiteral("\" \r\n     data-find-url=\"");


            
            #line 28 "..\..\Signum\Views\SearchControl.cshtml"
               Write(Navigator.FindRoute(findOptions.QueryName));

            
            #line default
            #line hidden
WriteLiteral("\" \r\n     >\r\n\r\n    ");


            
            #line 31 "..\..\Signum\Views\SearchControl.cshtml"
Write(Html.Hidden(Model.Compose("sfEntityTypeNames"), 
                                implementations.IsByAll ? "[All]" :
                                implementations.Types.ToString(t => Navigator.ResolveWebTypeName(t), ","), 
        new { disabled = "disabled" }));

            
            #line default
            #line hidden
WriteLiteral("\r\n    \r\n");


            
            #line 36 "..\..\Signum\Views\SearchControl.cshtml"
      
        bool filtersAlwaysHidden = findOptions.FilterMode == FilterMode.AlwaysHidden || findOptions.FilterMode == FilterMode.OnlyResults;
        bool filtersVisible = findOptions.FilterMode == FilterMode.Visible;
     

            
            #line default
            #line hidden
WriteLiteral("    \r\n    <div style=\"display:");


            
            #line 41 "..\..\Signum\Views\SearchControl.cshtml"
                    Write(filtersAlwaysHidden ? "none" : "block");

            
            #line default
            #line hidden
WriteLiteral("\">\r\n        <div class=\"sf-fields-list\">\r\n            <div class=\"ui-widget sf-fi" +
"lters\" ");


            
            #line 43 "..\..\Signum\Views\SearchControl.cshtml"
                                          Write(filtersVisible ? "" : "style=display:none");

            
            #line default
            #line hidden
WriteLiteral(">\r\n                <div class=\"ui-widget-header ui-corner-top sf-filters-body\">\r\n" +
"                    ");


            
            #line 45 "..\..\Signum\Views\SearchControl.cshtml"
               Write(Html.QueryTokenBuilder(null, Model, queryDescription));

            
            #line default
            #line hidden
WriteLiteral("\r\n                \r\n                    ");


            
            #line 47 "..\..\Signum\Views\SearchControl.cshtml"
               Write(Html.Href(
                            Model.Compose("btnAddFilter"), 
                            Resources.FilterBuilder_AddFilter, 
                            "",
                            Resources.Signum_selectToken,
                            "sf-query-button sf-add-filter sf-disabled", 
                            new Dictionary<string, object> 
                            { 
                                { "data-icon", "ui-icon-arrowthick-1-s" }
                            }));

            
            #line default
            #line hidden
WriteLiteral("\r\n\r\n");


            
            #line 58 "..\..\Signum\Views\SearchControl.cshtml"
                     if (string.IsNullOrEmpty(Model.ControlID) && findOptions.AllowChangeColumns)
                    {
                        
            
            #line default
            #line hidden
            
            #line 60 "..\..\Signum\Views\SearchControl.cshtml"
                   Write(Html.Href(
                            Model.Compose("btnAddColumn"), 
                            Resources.FilterBuilder_AddColumn, 
                            "",
                            Resources.Signum_selectToken,
                            "sf-query-button sf-add-column sf-disabled", 
                            new Dictionary<string, object> 
                            { 
                                { "data-icon", "ui-icon-arrowthick-1-e" },
                                { "data-url", Url.SignumAction("GetColumnName") }
                            }));

            
            #line default
            #line hidden
            
            #line 70 "..\..\Signum\Views\SearchControl.cshtml"
                              
                    }

            
            #line default
            #line hidden
WriteLiteral("                </div>\r\n");


            
            #line 73 "..\..\Signum\Views\SearchControl.cshtml"
                   
                    ViewData[ViewDataKeys.FilterOptions] = findOptions.FilterOptions;
                    Html.RenderPartial(Navigator.Manager.FilterBuilderView); 
                

            
            #line default
            #line hidden
WriteLiteral("            </div>\r\n        </div>\r\n    </div>\r\n    \r\n");


            
            #line 81 "..\..\Signum\Views\SearchControl.cshtml"
     if (!filtersAlwaysHidden)
    {
        
            
            #line default
            #line hidden
            
            #line 83 "..\..\Signum\Views\SearchControl.cshtml"
   Write(Html.Href("",
                (filtersVisible ? Resources.Signum_hideFilters : Resources.Signum_showFilters),
                "",
                (filtersVisible ? Resources.Signum_hideFilters : Resources.Signum_showFilters),
                "sf-query-button sf-filters-header" + (filtersVisible ? "" : " close"),
                new Dictionary<string, object> 
                { 
                    { "onclick", "{0}.toggleFilters()".Formato(jsFindNavigator.ToJS()) },
                    { "data-icon", filtersVisible ? "ui-icon-triangle-1-n" : "ui-icon-triangle-1-e" }
                }));

            
            #line default
            #line hidden
            
            #line 92 "..\..\Signum\Views\SearchControl.cshtml"
                  
    }

            
            #line default
            #line hidden

            
            #line 94 "..\..\Signum\Views\SearchControl.cshtml"
     if (findOptions.FilterMode != FilterMode.OnlyResults && (bool?)ViewData[ViewDataKeys.InPopup] != true)
    { 
        
            
            #line default
            #line hidden
            
            #line 96 "..\..\Signum\Views\SearchControl.cshtml"
   Write(Html.Href(Model.Compose("sfFullScreen"),
            "Full Screen",
            "",
            "Full Screen",
            "sf-query-button sf-query-fullscreen", 
            new Dictionary<string, object> 
            { 
                { "data-icon", "ui-icon-extlink" },
                { "data-text", false }
            }));

            
            #line default
            #line hidden
            
            #line 105 "..\..\Signum\Views\SearchControl.cshtml"
              
    }

            
            #line default
            #line hidden
WriteLiteral("    \r\n    <div class=\"sf-query-button-bar\" style=\"display:");


            
            #line 108 "..\..\Signum\Views\SearchControl.cshtml"
                                                Write((findOptions.FilterMode != FilterMode.OnlyResults) ? "block" : "none");

            
            #line default
            #line hidden
WriteLiteral("\">\r\n        <button type=\"submit\" class=\"sf-query-button sf-search\" data-icon=\"ui" +
"-icon-search\" id=\"");


            
            #line 109 "..\..\Signum\Views\SearchControl.cshtml"
                                                                                          Write(Model.Compose("qbSearch"));

            
            #line default
            #line hidden
WriteLiteral("\" onclick=\"");


            
            #line 109 "..\..\Signum\Views\SearchControl.cshtml"
                                                                                                                                Write(jsFindNavigator.search().ToJS() + ";return false");

            
            #line default
            #line hidden
WriteLiteral("\">");


            
            #line 109 "..\..\Signum\Views\SearchControl.cshtml"
                                                                                                                                                                                     Write(Resources.Search);

            
            #line default
            #line hidden
WriteLiteral("</button>\r\n");


            
            #line 110 "..\..\Signum\Views\SearchControl.cshtml"
         if (findOptions.Create)
        {
            string creating = findOptions.Creating.HasText() ? 
                    findOptions.Creating :
                    "{0}.create();return false;".Formato(jsFindNavigator.ToJS());

            
            #line default
            #line hidden
WriteLiteral("            <a class=\"sf-query-button\" data-icon=\"ui-icon-plusthick\" data-text=\"f" +
"alse\" id=\"");


            
            #line 115 "..\..\Signum\Views\SearchControl.cshtml"
                                                                                      Write(Model.Compose("qbSearchCreate"));

            
            #line default
            #line hidden
WriteLiteral("\" onclick=\"");


            
            #line 115 "..\..\Signum\Views\SearchControl.cshtml"
                                                                                                                                 Write(creating);

            
            #line default
            #line hidden
WriteLiteral("\">");


            
            #line 115 "..\..\Signum\Views\SearchControl.cshtml"
                                                                                                                                            Write(Resources.Search_Create);

            
            #line default
            #line hidden
WriteLiteral("</a>\r\n");


            
            #line 116 "..\..\Signum\Views\SearchControl.cshtml"
        }

            
            #line default
            #line hidden
WriteLiteral("        ");


            
            #line 117 "..\..\Signum\Views\SearchControl.cshtml"
   Write(ButtonBarQueryHelper.GetButtonBarElementsForQuery(new QueryButtonContext
   {
       ControllerContext = this.ViewContext,
       QueryName = findOptions.QueryName,
       ManualQueryButtons = (ToolBarButton[])ViewData[ViewDataKeys.ManualToolbarButtons],
       EntityType = entitiesType,
       Prefix = Model.ControlID
   }).ToString(Html));

            
            #line default
            #line hidden
WriteLiteral("\r\n    </div>\r\n");


            
            #line 126 "..\..\Signum\Views\SearchControl.cshtml"
     if (findOptions.FilterMode != FilterMode.OnlyResults)
    {

            
            #line default
            #line hidden
WriteLiteral("        <div class=\"clearall\">\r\n        </div>\r\n");


            
            #line 130 "..\..\Signum\Views\SearchControl.cshtml"
    }

            
            #line default
            #line hidden
WriteLiteral("    <div id=\"");


            
            #line 131 "..\..\Signum\Views\SearchControl.cshtml"
        Write(Model.Compose("divResults"));

            
            #line default
            #line hidden
WriteLiteral("\" class=\"ui-widget ui-corner-all sf-search-results-container\">\r\n        <table id" +
"=\"");


            
            #line 132 "..\..\Signum\Views\SearchControl.cshtml"
              Write(Model.Compose("tblResults"));

            
            #line default
            #line hidden
WriteLiteral("\" class=\"sf-search-results\">\r\n            <thead class=\"ui-widget-header ui-corne" +
"r-top\">\r\n                <tr>\r\n");


            
            #line 135 "..\..\Signum\Views\SearchControl.cshtml"
                     if (findOptions.AllowMultiple.HasValue)
                    {

            
            #line default
            #line hidden
WriteLiteral("                        <th class=\"ui-state-default th-col-selection\">\r\n");


            
            #line 138 "..\..\Signum\Views\SearchControl.cshtml"
                             if (findOptions.AllowMultiple.Value)
                            {
                                
            
            #line default
            #line hidden
            
            #line 140 "..\..\Signum\Views\SearchControl.cshtml"
                           Write(Html.CheckBox(Model.Compose("cbSelectAll"), false, new { onclick = "{0}.toggleSelectAll()".Formato(jsFindNavigator.ToJS()) }));

            
            #line default
            #line hidden
            
            #line 140 "..\..\Signum\Views\SearchControl.cshtml"
                                                                                                                                                              
                            }

            
            #line default
            #line hidden
WriteLiteral("                        </th>\r\n");


            
            #line 143 "..\..\Signum\Views\SearchControl.cshtml"
                    }

            
            #line default
            #line hidden

            
            #line 144 "..\..\Signum\Views\SearchControl.cshtml"
                     if (findOptions.View)
                    {

            
            #line default
            #line hidden
WriteLiteral("                        <th class=\"ui-state-default th-col-entity\">\r\n            " +
"            </th>\r\n");


            
            #line 148 "..\..\Signum\Views\SearchControl.cshtml"
                    }

            
            #line default
            #line hidden

            
            #line 149 "..\..\Signum\Views\SearchControl.cshtml"
                      List<Column> columns = findOptions.MergeColumns(); 

            
            #line default
            #line hidden

            
            #line 150 "..\..\Signum\Views\SearchControl.cshtml"
                     foreach (var col in columns)
                    {
                        var order = findOptions.OrderOptions.FirstOrDefault(oo => oo.Token.FullKey() == col.Name);
                        OrderType? orderType = null;
                        if (order != null)
                        {
                            orderType = order.OrderType;
                        }

            
            #line default
            #line hidden
WriteLiteral("                        <th class=\"ui-state-default ");


            
            #line 158 "..\..\Signum\Views\SearchControl.cshtml"
                                                Write((orderType == null) ? "" : (orderType == OrderType.Ascending ? "sf-header-sort-down" : "sf-header-sort-up"));

            
            #line default
            #line hidden
WriteLiteral("\">\r\n                            <div class=\"sf-header-droppable sf-header-droppab" +
"le-right\"></div>\r\n                            <div class=\"sf-header-droppable sf" +
"-header-droppable-left\"></div>\r\n                            <input type=\"hidden\"" +
" value=\"");


            
            #line 161 "..\..\Signum\Views\SearchControl.cshtml"
                                                   Write(col.Name);

            
            #line default
            #line hidden
WriteLiteral("\" />\r\n                            <span>");


            
            #line 162 "..\..\Signum\Views\SearchControl.cshtml"
                             Write(col.DisplayName);

            
            #line default
            #line hidden
WriteLiteral("</span>\r\n                        </th>\r\n");


            
            #line 164 "..\..\Signum\Views\SearchControl.cshtml"
                    }

            
            #line default
            #line hidden
WriteLiteral("                </tr>\r\n            </thead>\r\n            <tbody class=\"ui-widget-" +
"content\">\r\n");


            
            #line 168 "..\..\Signum\Views\SearchControl.cshtml"
                   int columnsCount = columns.Count + (findOptions.View ? 1 : 0) + (findOptions.AllowMultiple.HasValue ? 1 : 0); 

            
            #line default
            #line hidden
WriteLiteral("                <tr>\r\n                    <td colspan=\"");


            
            #line 170 "..\..\Signum\Views\SearchControl.cshtml"
                            Write(columnsCount);

            
            #line default
            #line hidden
WriteLiteral("\">");


            
            #line 170 "..\..\Signum\Views\SearchControl.cshtml"
                                           Write(Resources.Signum_noResults);

            
            #line default
            #line hidden
WriteLiteral("</td>\r\n                </tr>\r\n");


            
            #line 172 "..\..\Signum\Views\SearchControl.cshtml"
                   
                    ViewData[ViewDataKeys.ElementsPerPage] = findOptions.ElementsPerPage;
                    ViewData[ViewDataKeys.FilterMode] = findOptions.FilterMode;
                    ViewData[ViewDataKeys.SearchControlColumnsCount] = columnsCount;
                

            
            #line default
            #line hidden
WriteLiteral("                ");


            
            #line 177 "..\..\Signum\Views\SearchControl.cshtml"
           Write(Html.Partial(Navigator.Manager.PaginationView, Model));

            
            #line default
            #line hidden
WriteLiteral("\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n</div>\r\n");


            
            #line 182 "..\..\Signum\Views\SearchControl.cshtml"
   
    var jsFindOptions = new JsFindOptions() 
    { 
        FindOptions = findOptions,
        Prefix = Model.ControlID,
        ElementsPerPage = findOptions.ElementsPerPage
    };


            
            #line default
            #line hidden
WriteLiteral("<script type=\"text/javascript\">\r\n    $(\"#");


            
            #line 191 "..\..\Signum\Views\SearchControl.cshtml"
   Write(Model.Compose("sfSearchControl"));

            
            #line default
            #line hidden
WriteLiteral("\").findNavigator(");


            
            #line 191 "..\..\Signum\Views\SearchControl.cshtml"
                                                     Write(MvcHtmlString.Create(jsFindOptions.ToJS()));

            
            #line default
            #line hidden
WriteLiteral(");\r\n</script>\r\n");


        }
    }
}
#pragma warning restore 1591
